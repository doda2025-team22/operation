# Global configuration
global:
  domain: "local"
  stableSubdomain: "team22"
  prereleaseSubdomain: "team22-dev"
  ingressGatewayName: team22-gateway

config:
  appConfig:
    FEATURE_FLAG_TEST: "true"
    API_TIMEOUT_MS: "5000"

# Application configuration
app:
  stable:
    image:
      repository: ghcr.io/doda2025-team22/app
      tag: latest
    replicaCount: 1
    port: 8080
  canary:
    image:
      repository: ghcr.io/doda2025-team22/app
      tag: 1.1.latest
    replicaCount: 1
    port: 8080
  canaryWeight: 10
  stableWeight: 90

# Model service configuration
modelservice:
  stable:
    image:
      repository: ghcr.io/doda2025-team22/model-service
      tag: latest
    replicaCount: 1
    port: 8081
  canary:
    image:
      repository: ghcr.io/doda2025-team22/model-service
      tag: canary
    replicaCount: 1
    port: 8081
  canaryWeight: 10
  stableWeight: 90


# Monitoring configuration
monitoring:
  enabled: true
  prometheusRelease: monitoring

#alertmanager:
#  enabled: true
#  config:
#    global:
#      resolve_timeout: 5m
#      smtp_smarthost: "smtp.gmail.com:587"
#      smtp_from: "doda98124@gmail.com"
#      smtp_auth_username_file: /etc/alertmanager/secrets/smtpUser
#      smtp_auth_password_file: /etc/alertmanager/secrets/smtpPassword
#      smtp_require_tls: true
#
#    route:
#      receiver: team22-notifications
#      group_by: [ "alertname","service" ]
#      group_wait: 10s
#      group_interval: 5m
#
#    receivers:
#      - name: team22-notifications
#        email_configs:
#          - to: "doda98124@gmail.com"
#  smtp:
#    host: "smtp.gmail.com:587"
#  from: "doda98124@gmail.com"
#  to: "doda98124@gmail.com"
#  authSecret:
#    name: team22-alertmanager-secrets
#    userKey: smtpUser
#    passKey: smtpPassword

# kube-prometheus-stack subchart configuration
kube-prometheus-stack:
  # Enable Grafana from kube-prometheus-stack
  grafana:
    enabled: true
    # Admin credentials loaded from secret (grafana-admin-secret)
    admin:
      existingSecret: grafana-admin-secret
      userKey: admin-user
      passwordKey: admin-password
    service:
      type: ClusterIP
    persistence:
      enabled: false
    sidecar:
      datasources:
        enabled: true
        label: grafana_datasource
        labelValue: "1"
      dashboards:
        enabled: true
        label: grafana_dashboard
        labelValue: "1"
  prometheus:
    enabled: true
    prometheusSpec:
      serviceMonitorSelector:
        matchLabels:
          release: monitoring
      serviceMonitorNamespaceSelector: {}
  alertmanager:
    enabled: true
    alertmanagerSpec:
      replicas: 1
      secrets:
        - smtp-secret
    config:
      global:
        resolve_timeout: 5m
        smtp_smarthost: "smtp.gmail.com:587"
        smtp_from: "doda98124@gmail.com"
        smtp_auth_username: "doda98124@gmail.com"
        smtp_auth_password_file: /etc/alertmanager/secrets/smtp-secret/password
        smtp_require_tls: true
      route:
        receiver: team22-notifications
        group_by: [ "alertname","service" ]
        group_wait: 10s
        group_interval: 5m
      receivers:
        - name: "null"
        - name: "Watchdog"
        - name: team22-notifications
          email_configs:
            - to: "doda98124@gmail.com"


ratelimit:
  enable: true
  smsPageRpm: 10

# Grafana configuration (for Istio routing)
grafana:
  enabled: true
  grafanaHost: "grafana.local"

# Secrets configuration
secret:
  smtp:
    # these are placeholder values, the actual password for smtp is configured as a secret
    username: "doda98124@gmail.com"
    password: "ENTER_SECRET"
  grafana:
    adminUser: "admin"
    adminPassword: "admin"